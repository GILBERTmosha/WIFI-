<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOSHARUTA WiFi - Manager System 2026</title>
    <style>
        :root { --primary: #22d3ee; --bg: #0f172a; --card: #1e293b; --danger: #f43f5e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #f8fafc; margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: auto; background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #334155; }
        .hidden { display: none; }
        
        .menu { display: flex; justify-content: space-around; margin-bottom: 20px; border-bottom: 2px solid #334155; }
        .menu button { background: none; border: none; color: #94a3b8; padding: 10px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .menu button.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-save { background: #10b981; color: white; }
        .btn-admin { background: var(--danger); color: white; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 11px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #334155; }
        .total-box { background: #064e3b; padding: 12px; border-radius: 10px; text-align: center; margin-top: 15px; font-size: 18px; color: #34d399; font-weight: bold; }
        
        .backup-panel { background: #0f172a; padding: 15px; border-radius: 15px; margin-top: 20px; border: 1px dashed var(--primary); }
        .secret-code { background: #1e293b; padding: 10px; color: var(--primary); font-family: monospace; text-align: center; font-size: 18px; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-section">
        <h2 style="text-align:center">üì° MOSHARUTA ACCESS</h2>
        <p style="text-align:center; font-size:12px; color:#94a3b8">Ingiza Email na Password yako</p>
        <input type="email" id="emailIn" placeholder="Email (kingshamo47@gmail.com)">
        <input type="password" id="passIn" placeholder="Password (2007+ au MOSHA)">
        <button class="btn btn-save" onclick="handleLogin()">INGIA KAZINI</button>
    </div>

    <div id="main-content" class="hidden">
        <div style="text-align:center; margin-bottom:10px;"><small id="userLabel"></small></div>
        
        <div class="menu">
            <button id="tab1" class="active" onclick="switchTab('calc')">CALC</button>
            <button id="tab2" onclick="switchTab('entry')">SAJILI</button>
            <button id="tab3" onclick="switchTab('list')">LISTI</button>
            <button id="tab4" class="hidden" onclick="switchTab('admin')">ADMIN CENTER</button>
        </div>

        <div id="calc-section">
            <input type="text" id="display" style="text-align:right; font-size:24px;" placeholder="0" readonly>
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px;">
                <button class="btn" onclick="clearC()" style="background:#ef4444">C</button>
                <button class="btn" onclick="press('/')" style="background:#334155">/</button>
                <button class="btn" onclick="press('*')" style="background:#334155">√ó</button>
                <button class="btn" onclick="press('-')" style="background:#334155">-</button>
                <button class="btn" onclick="press('7')" style="background:#475569">7</button>
                <button class="btn" onclick="press('8')" style="background:#475569">8</button>
                <button class="btn" onclick="press('9')" style="background:#475569">9</button>
                <button class="btn" onclick="press('+')" style="background:#334155">+</button>
                <button class="btn" onclick="calcResult()" style="background:#10b981; grid-row: span 3">=</button>
                <button class="btn" onclick="press('4')" style="background:#475569">4</button>
                <button class="btn" onclick="press('5')" style="background:#475569">5</button>
                <button class="btn" onclick="press('6')" style="background:#475569">6</button>
                <button class="btn" onclick="press('1')" style="background:#475569">1</button>
                <button class="btn" onclick="press('2')" style="background:#475569">2</button>
                <button class="btn" onclick="press('3')" style="background:#475569">3</button>
                <button class="btn" onclick="press('0')" style="grid-column: span 2; background:#475569">0</button>
                <button class="btn" onclick="press('.')" style="background:#475569">.</button>
            </div>
        </div>

        <div id="entry-section" class="hidden">
            <h3>üìù Sajili Malipo ya WiFi</h3>
            <input type="text" id="mName" placeholder="Jina la Mteja">
            <input type="text" id="mPhone" placeholder="Namba ya Simu">
            <input type="number" id="mAmount" placeholder="Kiasi (Tsh)">
            <button class="btn btn-save" onclick="saveRecord()">HIFADHI DATA</button>
        </div>

        <div id="list-section" class="hidden">
            <h4>Mauzo Yako Binafsi</h4>
            <div id="userList"></div>
        </div>

        <div id="admin-section" class="hidden">
            <h3 style="color:var(--danger)">üîê Admin Panel (Manager Mode)</h3>
            <table>
                <thead><tr><th>Mtumiaji (Email)</th><th>Mteja</th><th>Kiasi</th><th>Action</th></tr></thead>
                <tbody id="adminTable"></tbody>
            </table>
            <div class="total-box">JUMLA KUU: <span id="grandTotal">0</span> /=</div>

            <div class="backup-panel">
                <h4>‚òÅÔ∏è Cloud Backup & Username View</h4>
                <p style="font-size:10px;">Zalisha Backup Code kisha itunze kwa ajili ya kurudisha data.</p>
                <div id="backupCodeDisplay" class="secret-code">---- ---- ----</div>
                <button class="btn btn-save" onclick="generateBackup()">ZALISHA BACKUP CODE</button>
                <button class="btn" style="background:#475569; margin-top:10px;" onclick="restoreProcess()">RUDISHA DATA KWA CODE</button>
            </div>
        </div>

        <button class="btn" style="background:#475569; margin-top:30px" onclick="location.reload()">LOGOUT</button>
    </div>
</div>

<script>
    const ADMIN_EMAIL = "kingshamo47@gmail.com";
    const ADMIN_PASS = "2007+";
    const STAFF_PASS = "MOSHA";

    let currentUser = "";
    let userIsAdmin = false;

    function handleLogin() {
        let e = document.getElementById('emailIn').value.trim();
        let p = document.getElementById('passIn').value.trim();

        if (e === ADMIN_EMAIL && p === ADMIN_PASS) {
            userIsAdmin = true; currentUser = e;
            document.getElementById('tab4').classList.remove('hidden');
        } else if (e && p === STAFF_PASS) {
            userIsAdmin = false; currentUser = e;
        } else {
            return alert("Umekosea Email au Password!");
        }

        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('userLabel').innerHTML = `Login kama: <b>${currentUser}</b>`;
        switchTab('calc');
    }

    function switchTab(t) {
        ['calc-section', 'entry-section', 'list-section', 'admin-section'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(t + '-section').classList.remove('hidden');
        if(t === 'list') renderUserList();
        if(t === 'admin') renderAdminTable();
    }

    // Calc Logic
    let expr = "";
    function press(v) { expr += v; document.getElementById('display').value = expr; }
    function clearC() { expr = ""; document.getElementById('display').value = ""; }
    function calcResult() { try { expr = eval(expr).toString(); document.getElementById('display').value = expr; } catch { clearC(); } }

    // Data Management
    function saveRecord() {
        let m = document.getElementById('mName').value, n = document.getElementById('mPhone').value, a = document.getElementById('mAmount').value;
        if(!m || !a) return alert("Jaza Jina na Kiasi!");
        let db = JSON.parse(localStorage.getItem('mosharuta_main_db')) || [];
        db.push({ owner: currentUser, mteja: m, namba: n, kiasi: parseFloat(a), date: new Date().toLocaleString() });
        localStorage.setItem('mosharuta_main_db', JSON.stringify(db));
        alert("Data imehifadhiwa!");
        document.getElementById('mName').value = ''; document.getElementById('mAmount').value = '';
        switchTab('list');
    }

    function renderUserList() {
        let db = JSON.parse(localStorage.getItem('mosharuta_main_db')) || [];
        let myData = db.filter(x => x.owner === currentUser);
        let h = "<table><thead><tr><th>Mteja</th><th>Tsh</th><th>Tuma</th></tr></thead><tbody>";
        myData.forEach(d => {
            h += `<tr><td>${d.mteja}</td><td>${d.kiasi.toLocaleString()}</td>
            <td>
                <button onclick="sendMsg('sms','${d.namba}','${d.mteja}',${d.kiasi},'${d.date}')" style="background:none; border:none; cursor:pointer">üîµ</button>
                <button onclick="sendMsg('wa','${d.namba}','${d.mteja}',${d.kiasi},'${d.date}')" style="background:none; border:none; cursor:pointer">üü¢</button>
            </td></tr>`;
        });
        h += "</tbody></table>";
        document.getElementById('userList').innerHTML = h;
    }

    function renderAdminTable() {
        let db = JSON.parse(localStorage.getItem('mosharuta_main_db')) || [];
        let html = ""; let total = 0;
        db.forEach((d, i) => {
            html += `<tr><td><small>${d.owner}</small></td><td>${d.mteja}</td><td>${d.kiasi.toLocaleString()}</td>
            <td><button onclick="adminDelete(${i})" style="background:none; border:none; cursor:pointer">üóëÔ∏è</button></td></tr>`;
            total += d.kiasi;
        });
        document.getElementById('adminTable').innerHTML = html;
        document.getElementById('grandTotal').innerText = total.toLocaleString();
    }

    function adminDelete(i) {
        if(confirm("Manager: Unataka kufuta rekodi hii?")) {
            let db = JSON.parse(localStorage.getItem('mosharuta_main_db'));
            db.splice(i, 1);
            localStorage.setItem('mosharuta_main_db', JSON.stringify(db));
            renderAdminTable();
        }
    }

    function sendMsg(type, num, name, amt, date) {
        let msg = `Habari ${name}, \nAsante kwa kulipia MOSHARUTA WiFi. \nüí∞ Kiasi: Tsh ${amt.toLocaleString()} \nüìÖ Tarehe: ${date} \nKaribu tena! üì°`;
        if(type === 'wa') {
            let n = num.startsWith('0') ? '255' + num.substring(1) : num;
            window.open(`https://wa.me/${n}?text=${encodeURIComponent(msg)}`, '_blank');
        } else {
            let sep = (navigator.userAgent.toLowerCase().indexOf("iphone") > -1) ? "&" : "?";
            window.location.href = `sms:${num}${sep}body=${encodeURIComponent(msg)}`;
        }
    }

    // BACKUP SYSTEM
    function generateBackup() {
        let db = localStorage.getItem('mosharuta_main_db');
        if(!db || db === "[]") return alert("Hakuna data ya kuhifadhi!");
        let bCode = "MOSHA-" + Math.floor(1000 + Math.random() * 9999) + "-SEC";
        localStorage.setItem('last_cloud_db', db);
        localStorage.setItem('last_cloud_code', bCode);
        document.getElementById('backupCodeDisplay').innerText = bCode;
        alert("Backup Code Imezalishwa!");
    }

    function restoreProcess() {
        let code = prompt("Ingiza Backup Code ya Siri:");
        if(code === localStorage.getItem('last_cloud_code')) {
            localStorage.setItem('mosharuta_main_db', localStorage.getItem('last_cloud_db'));
            alert("Data Zote Zimerudishwa!");
            renderAdminTable();
        } else { alert("Code imekosewa!"); }
    }
</script>
</body>
</html>
