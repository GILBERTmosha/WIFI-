<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOSHARUTH WiFi System</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #f8fafc; margin: 0; padding: 10px; }
        .container { max-width: 550px; margin: auto; background: #1e293b; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .hidden { display: none; }
        
        .menu { display: flex; justify-content: space-around; margin-bottom: 20px; border-bottom: 2px solid #334155; }
        .menu button { background: none; border: none; color: #94a3b8; padding: 10px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .menu button.active { color: #22d3ee; border-bottom: 3px solid #22d3ee; }

        #display { width: 100%; height: 60px; background: #0f172a; color: #22d3ee; border: none; border-radius: 8px; margin-bottom: 10px; text-align: right; padding: 15px; font-size: 24px; font-family: monospace; box-sizing: border-box; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .calc-grid button { padding: 18px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; background: #334155; color: white; }
        .btn-op { background: #0ea5e9 !important; }
        .btn-eq { background: #10b981 !important; grid-column: span 2; }
        .btn-clr { background: #ef4444 !important; }

        label { display: block; margin-top: 10px; color: #94a3b8; font-size: 14px; }
        input { width: 100%; padding: 12px; margin: 5px 0 15px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn-action { width: 100%; padding: 12px; background: #10b981; border: none; color: white; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #334155; color: #22d3ee; }
        .total-box { background: #064e3b; padding: 15px; border-radius: 10px; text-align: center; margin-top: 20px; font-size: 20px; color: #34d399; font-weight: bold; }
        
        .actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-wa { color: #25d366; background: none; border: none; cursor: pointer; font-weight: bold; }
        .btn-edit { color: #facc15; background: none; border: none; cursor: pointer; }
        .btn-del { color: #ef4444; background: none; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-section">
        <h2 style="text-align:center">üîê MOSHARUTH ACCESS</h2>
        <input type="password" id="secretCode" placeholder="Ingiza Password...">
        <button class="btn-action" style="background:#0ea5e9" onclick="checkCode()">FUNGUA MFUMO</button>
    </div>

    <div id="main-content" class="hidden">
        <div class="menu">
            <button id="tab1" class="active" onclick="showTab('calc')">CALC</button>
            <button id="tab2" onclick="showTab('entry')">SAJILI</button>
            <button id="tab3" onclick="showTab('list')">LISTI DATA</button>
        </div>

        <div id="calc-section">
            <input type="text" id="display" placeholder="0" readonly>
            <div class="calc-grid">
                <button class="btn-clr" onclick="clearCalc()">C</button>
                <button class="btn-op" onclick="press('/')">/</button>
                <button class="btn-op" onclick="press('*')">√ó</button>
                <button class="btn-op" onclick="press('-')">-</button>
                <button onclick="press('7')">7</button><button onclick="press('8')">8</button><button onclick="press('9')">9</button>
                <button class="btn-op" onclick="press('+')">+</button>
                <button onclick="press('4')">4</button><button onclick="press('5')">5</button><button onclick="press('6')">6</button>
                <button onclick="press('x')" style="background:#8b5cf6">x</button>
                <button onclick="press('1')">1</button><button onclick="press('2')">2</button><button onclick="press('3')">3</button>
                <button class="btn-eq" onclick="calculate()">=</button>
                <button onclick="press('0')" style="grid-column: span 2">0</button>
                <button onclick="press('.')">.</button>
            </div>
        </div>

        <div id="entry-section" class="hidden">
            <h3 id="form-title">üìù Sajili Mteja Mpya</h3>
            <input type="hidden" id="edit-index">
            <label>Jina la Mteja:</label>
            <input type="text" id="mteja" placeholder="Jina la mteja">
            <label>Namba ya WhatsApp (Anza na 255...):</label>
            <input type="text" id="namba_elimu" placeholder="Mfano: 255712345678">
            <label>Kiasi alicholipa (Tsh):</label>
            <input type="number" id="kiasi" placeholder="Mfano: 1000">
            <button id="btn-save" class="btn-action" onclick="saveData()">HIFADHI DATA</button>
            <button id="btn-update" class="btn-action hidden" style="background:#facc15; color:#000" onclick="updateData()">SAHIHISHA DATA</button>
        </div>

        <div id="list-section" class="hidden">
            <h3>üìã Orodha ya Mauzo</h3>
            <input type="text" id="search" placeholder="üîç Tafuta..." onkeyup="showData()">
            <table>
                <thead>
                    <tr><th>Mteja/Tarehe</th><th>Kiasi</th><th>Actions</th></tr>
                </thead>
                <tbody id="dataBody"></tbody>
            </table>
            <div class="total-box">JUMLA: <span id="jumlaKuu">0</span> /=</div>
        </div>

        <button style="background:#475569; margin-top:30px;" class="btn-action" onclick="location.reload()">LOGOUT</button>
    </div>
</div>

<script>
    const SIRI = "MOSHARUTH";

    function checkCode() {
        if(document.getElementById('secretCode').value === SIRI) {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            showData();
        } else { alert("Password Siyo Sahihi!"); }
    }

    function showTab(tab) {
        document.getElementById('calc-section').classList.add('hidden');
        document.getElementById('entry-section').classList.add('hidden');
        document.getElementById('list-section').classList.add('hidden');
        document.getElementById('tab1').classList.remove('active');
        document.getElementById('tab2').classList.remove('active');
        document.getElementById('tab3').classList.remove('active');

        if(tab === 'calc') { document.getElementById('calc-section').classList.remove('hidden'); document.getElementById('tab1').classList.add('active'); }
        else if(tab === 'entry') { document.getElementById('entry-section').classList.remove('hidden'); document.getElementById('tab2').classList.add('active'); }
        else { document.getElementById('list-section').classList.remove('hidden'); document.getElementById('tab3').classList.add('active'); showData(); }
    }

    let expr = "";
    function press(v) { expr += v; document.getElementById('display').value = expr; }
    function clearCalc() { expr = ""; document.getElementById('display').value = ""; }
    function calculate() { try { expr = eval(expr).toString(); document.getElementById('display').value = expr; } catch { alert("Error!"); clearCalc(); } }

    function saveData() {
        let mteja = document.getElementById('mteja').value;
        let namba = document.getElementById('namba_elimu').value;
        let kiasi = document.getElementById('kiasi').value;
        if(!mteja || !kiasi) return alert("Jaza Jina na Kiasi!");

        let data = JSON.parse(localStorage.getItem('wifiData')) || [];
        data.push({ 
            mteja, 
            namba: namba || "", 
            kiasi: parseFloat(kiasi), 
            tarehe: new Date().toLocaleString('sw-TZ') 
        });
        localStorage.setItem('wifiData', JSON.stringify(data));
        
        clearForm();
        showTab('list');
    }

    function showData() {
        let data = JSON.parse(localStorage.getItem('wifiData')) || [];
        let search = document.getElementById('search').value.toLowerCase();
        let html = ""; let total = 0;

        data.forEach((item, index) => {
            if(item.mteja.toLowerCase().includes(search) || item.namba.includes(search)) {
                html += `<tr>
                    <td><b>${item.mteja}</b><br><small style="color:#94a3b8">${item.tarehe}</small><br><small>${item.namba}</small></td>
                    <td>${item.kiasi.toLocaleString()}</td>
                    <td class="actions">
                        <button class="btn-wa" onclick="sendWhatsApp(${index})">WA</button>
                        <button class="btn-edit" onclick="editData(${index})">Edit</button>
                        <button class="btn-del" onclick="deleteData(${index})">X</button>
                    </td>
                </tr>`;
                total += item.kiasi;
            }
        });
        document.getElementById('dataBody').innerHTML = html;
        document.getElementById('jumlaKuu').innerText = total.toLocaleString();
    }

    function sendWhatsApp(index) {
        let data = JSON.parse(localStorage.getItem('wifiData'));
        let item = data[index];
        if(!item.namba) return alert("Huyu mteja hana namba ya simu!");

        let ujumbe = `Habari ${item.mteja}, \n\nAsante kwa kulipia huduma ya WiFi kutoka *MOSHARUTH WiFi*. \n\nüí∞ *Kiasi:* Tsh ${item.kiasi.toLocaleString()} \nüìÖ *Tarehe:* ${item.tarehe} \n\nKaribu tena! üì°`;
        let link = `https://wa.me/${item.namba}?text=${encodeURIComponent(ujumbe)}`;
        window.open(link, '_blank');
    }

    function editData(index) {
        let data = JSON.parse(localStorage.getItem('wifiData'));
        let item = data[index];
        document.getElementById('mteja').value = item.mteja;
        document.getElementById('namba_elimu').value = item.namba;
        document.getElementById('kiasi').value = item.kiasi;
        document.getElementById('edit-index').value = index;
        document.getElementById('form-title').innerText = "üîÑ Sahihisha Data";
        document.getElementById('btn-save').classList.add('hidden');
        document.getElementById('btn-update').classList.remove('hidden');
        showTab('entry');
    }

    function updateData() {
        let index = document.getElementById('edit-index').value;
        let data = JSON.parse(localStorage.getItem('wifiData'));
        data[index].mteja = document.getElementById('mteja').value;
        data[index].namba = document.getElementById('namba_elimu').value;
        data[index].kiasi = parseFloat(document.getElementById('kiasi').value);
        localStorage.setItem('wifiData', JSON.stringify(data));
        clearForm();
        showTab('list');
    }

    function deleteData(i) {
        if(confirm("Futa rekodi hii?")) {
            let data = JSON.parse(localStorage.getItem('wifiData'));
            data.splice(i, 1);
            localStorage.setItem('wifiData', JSON.stringify(data));
            showData();
        }
    }

    function clearForm() {
        document.getElementById('mteja').value = "";
        document.getElementById('namba_elimu').value = "";
        document.getElementById('kiasi').value = "";
        document.getElementById('form-title').innerText = "üìù Sajili Mteja Mpya";
        document.getElementById('btn-save').classList.remove('hidden');
        document.getElementById('btn-update').classList.add('hidden');
    }
</script>
</body>
</html>
