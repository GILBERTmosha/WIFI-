<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MOSHARUTH WiFi - SMS & WA</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
    body{font-family:sans-serif;background:#0f172a;color:#fff;margin:0;padding:15px}
    .container{max-width:400px;margin:auto;background:#111;padding:20px;border-radius:15px;box-shadow:0 0 15px gold}
    h2{text-align:center;color:gold;margin-top:0}
    input, textarea, button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none;box-sizing:border-box}
    input, textarea{background:#222;color:#fff;border:1px solid #333}
    button{background:gold;color:#000;font-weight:bold;cursor:pointer}
    .hidden{display:none}
    .card{background:#1e293b;padding:12px;border-radius:10px;margin-top:10px;border-left:4px solid gold}
    .flex{display:flex;gap:5px;margin-top:10px;flex-wrap:wrap}
    .btn-edit{background:#3b82f6;color:#fff;flex:1;font-size:11px}
    .btn-wa{background:#25D366;color:#fff;flex:1;font-size:11px}
    .btn-sms{background:#ffffff;color:#000;flex:1;font-size:11px}
    .btn-del{background:#ef4444;color:#fff;width:40px}
    .bulk-section{margin-top:20px; border-top: 1px solid #444; padding-top: 10px; background: #161e2e; padding: 10px; border-radius: 10px;}
    .warning-text {color: #ff4444; font-size: 12px; font-weight: bold; display: block; margin-top: 5px;}
</style>
</head>
<body>

<div id="loginBox" class="container">
    <h2>üîê LOGIN</h2>
    <input type="password" id="passInput" placeholder="Ingiza Password">
    <button onclick="login()">Ingia</button>
</div>

<div id="appBox" class="container hidden">
    <h2 id="title">üì° MOSHARUTH</h2>
    
    <input type="text" id="name" placeholder="Jina la mteja">
    <input type="number" id="amount" placeholder="Kiasi (Tsh)">
    <input type="tel" id="phone" placeholder="Namba ya simu">
    
    <button id="saveBtn" onclick="saveData()">üíæ Hifadhi Cloud</button>
    <button id="updateBtn" class="hidden" onclick="updateData()" style="background:orange">‚úÖ Sahihisha</button>

    <div class="bulk-section">
        <label style="font-size: 13px; color: gold;">üì¢ Ujumbe wa Onyo kwa Wote:</label>
        <textarea id="bulkMsg" rows="3">ILANI: Ni marufuku kushare password üîë ya WiFi utakayotumiwa kwenye SMS. Ukikiuka utafungiwa huduma bila refund. Karibu MOSHARUTH WiFi.</textarea>
        <button onclick="sendBulkSMS()" style="background:#4b5563; color:white;">üöÄ Tuma Onyo kwa Wote</button>
        <small class="warning-text">* Hii itafungua App ya SMS na namba zote za wateja.</small>
    </div>
    
    <div id="list" style="margin-top:15px">Inapakia...</div>
</div>

<script>
// --- KONFIGARESHENI YAKO IKO HAPA ---
const firebaseConfig = {
  apiKey: "AIzaSyDw5j_XYvLdqz7zAvJtSfOOEelfvkzjYqU",
  authDomain: "mosharuth-a466b.firebaseapp.com",
  databaseURL: "https://mosharuth-a466b-default-rtdb.firebaseio.com",
  projectId: "mosharuth-a466b",
  storageBucket: "mosharuth-a466b.firebasestorage.app",
  messagingSenderId: "571128004354",
  appId: "1:571128004354:web:3318c5239e2afb6644cc1b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let editId = null;

function login() {
    if(document.getElementById('passInput').value === "goldnature44") {
        document.getElementById('loginBox').classList.add('hidden');
        document.getElementById('appBox').classList.remove('hidden');
        loadData();
    } else { alert("Password sio sahihi!"); }
}

function saveData() {
    const n = document.getElementById('name').value;
    const a = document.getElementById('amount').value;
    const p = document.getElementById('phone').value;
    if(n && a && p) {
        db.ref('wateja').push({ jina: n, kiasi: a, namba: p });
        clear();
    }
}

function loadData() {
    db.ref('wateja').on('value', (snap) => {
        const list = document.getElementById('list');
        list.innerHTML = "";
        const data = snap.val();
        if(data) {
            Object.keys(data).reverse().forEach(key => {
                const u = data[key];
                list.innerHTML += `
                <div class="card">
                    <b>${u.jina}</b> - Tsh ${u.kiasi}<br>
                    <div class="flex">
                        <button class="btn-edit" onclick="startEdit('${key}','${u.jina}','${u.kiasi}','${u.namba}')">Edit</button>
                        <button class="btn-wa" onclick="sendWA('${u.jina}','${u.namba}')">WhatsApp</button>
                        <button class="btn-sms" onclick="sendSMS('${u.jina}','${u.namba}')">SMS</button>
                        <button class="btn-del" onclick="del('${key}')">üóëÔ∏è</button>
                    </div>
                </div>`;
            });
        }
    });
}

// Ujumbe wa mteja mmoja mmoja (unabaki na maelekezo ya password)
const getMsg = (name) => `Habari ${name}, Karibu MOSHARUTH WiFi.\nüì∂ WiFi: SMART_HOME_TZ\nüîê Pass: goldnature55\n‚ö†Ô∏è USISHARE PASSWORD HII NA MTU MWINGINE!`;

function sendSMS(name, phone) {
    window.open(`sms:${phone}?body=${encodeURIComponent(getMsg(name))}`, '_blank');
}

function sendBulkSMS() {
    const customMsg = document.getElementById('bulkMsg').value;
    if(!customMsg) {
        alert("Andika ujumbe kwanza!");
        return;
    }

    db.ref('wateja').once('value', (snap) => {
        const data = snap.val();
        if(data) {
            // Huunganisha namba zote kwa koma
            const nambaZote = Object.values(data).map(u => u.namba).join(',');
            window.open(`sms:${nambaZote}?body=${encodeURIComponent(customMsg)}`, '_blank');
        } else {
            alert("Database haina wateja!");
        }
    });
}

function sendWA(name, phone) {
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(getMsg(name))}`, '_blank');
}

function startEdit(id, n, a, p) {
    editId = id;
    document.getElementById('name').value = n;
    document.getElementById('amount').value = a;
    document.getElementById('phone').value = p;
    document.getElementById('saveBtn').classList.add('hidden');
    document.getElementById('updateBtn').classList.remove('hidden');
    document.getElementById('title').innerText = "‚úèÔ∏è EDIT DATA";
    window.scrollTo(0,0);
}

function updateData() {
    db.ref('wateja/' + editId).update({
        jina: document.getElementById('name').value,
        kiasi: document.getElementById('amount').value,
        namba: document.getElementById('phone').value
    });
    editId = null;
    document.getElementById('saveBtn').classList.remove('hidden');
    document.getElementById('updateBtn').classList.add('hidden');
    document.getElementById('title').innerText = "üì° MOSHARUTH";
    clear();
}

function del(id) { if(confirm("Futa?")) db.ref('wateja/' + id).remove(); }
function clear() { document.getElementById('name').value=""; document.getElementById('amount').value=""; document.getElementById('phone').value=""; }
</script>
</body>
</html>
