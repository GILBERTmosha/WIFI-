<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MOSHARUTH WiFi - Edit & SMS</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
body{font-family:Arial,sans-serif;background:#0f172a;color:#fff;margin:0;padding:10px}
.container{max-width:400px;margin:auto;background:#111;padding:20px;border-radius:15px;box-shadow:0 0 20px gold}
h2{text-align:center;color:gold}
input,button{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none;box-sizing:border-box}
input{background:#222;color:white;border:1px solid #333}
button{background:gold;color:black;font-weight:bold;cursor:pointer}
.hidden{display:none}
.card{background:#1e293b;padding:12px;border-radius:10px;margin-top:10px;border-left:5px solid gold}
.flex{display:flex;gap:5px;margin-top:8px}
.edit-btn{background:#3b82f6;color:white}
.sms-btn{background:#25D366;color:white}
.del-btn{background:#ef4444;color:white}
</style>
</head>
<body>

<div id="loginSection" class="container">
    <h2>üîê LOGIN</h2>
    <input type="password" id="passInput" placeholder="Password">
    <button onclick="checkLogin()">Ingia</button>
</div>

<div id="mainSection" class="container hidden">
    <h2 id="formTitle">üì° SAJILI MTEJA</h2>
    <input type="text" id="custName" placeholder="Jina">
    <input type="number" id="custAmount" placeholder="Kiasi">
    <input type="tel" id="custPhone" placeholder="Namba">
    
    <button id="saveBtn" onclick="saveData()">üíæ Hifadhi Cloud</button>
    <button id="updateBtn" class="hidden" onclick="updateData()" style="background:orange">‚úèÔ∏è Sahihisha (Update)</button>
    <button id="cancelBtn" class="hidden" onclick="cancelEdit()" style="background:#444;color:white">X Ghairi</button>
    
    <div id="customerList" style="margin-top:15px">Pakia data...</div>
</div>

<script>
// Kodi zako za Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDw5j_XYvLdqz7zAvJtSfOOEelfvkzjYqU",
  authDomain: "mosharuth-a466b.firebaseapp.com",
  databaseURL: "https://mosharuth-a466b-default-rtdb.firebaseio.com",
  projectId: "mosharuth-a466b",
  storageBucket: "mosharuth-a466b.firebasestorage.app",
  messagingSenderId: "571128004354",
  appId: "1:571128004354:web:3318c5239e2afb6644cc1b"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
let editId = null;

function checkLogin() {
    if(document.getElementById('passInput').value === "goldnature44") {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('mainSection').classList.remove('hidden');
        loadData();
    } else { alert("‚ùå Password Sio Sahihi!"); }
}

function saveData() {
    const name = document.getElementById('custName').value;
    const amount = document.getElementById('custAmount').value;
    const phone = document.getElementById('custPhone').value;
    if(name && amount && phone) {
        database.ref('wateja').push({ jina: name, kiasi: amount, namba: phone });
        clearForm();
    }
}

function loadData() {
    database.ref('wateja').on('value', (snapshot) => {
        const listDiv = document.getElementById('customerList');
        listDiv.innerHTML = "";
        const data = snapshot.val();
        if(data) {
            Object.keys(data).reverse().forEach(key => {
                const u = data[key];
                listDiv.innerHTML += `
                <div class="card">
                    <b>${u.jina}</b> - Tsh ${u.kiasi}<br>
                    <div class="flex">
                        <button class="edit-btn" onclick="startEdit('${key}', '${u.jina}', '${u.kiasi}', '${u.namba}')">‚úèÔ∏è Edit</button>
                        <button class="sms-btn" onclick="sendShortSMS('${u.jina}', '${u.namba}')">üí¨ SMS</button>
                        <button class="del-btn" onclick="deleteCust('${key}')">üóëÔ∏è</button>
                    </div>
                </div>`;
            });
        }
    });
}

// Sehemu ya EDIT
function startEdit(id, name, amount, phone) {
    editId = id;
    document.getElementById('custName').value = name;
    document.getElementById('custAmount').value = amount;
    document.getElementById('custPhone').value = phone;
    document.getElementById('formTitle').innerText = "‚úèÔ∏è SAHIHISHA DATA";
    document.getElementById('saveBtn').classList.add('hidden');
    document.getElementById('updateBtn').classList.remove('hidden');
    document.getElementById('cancelBtn').classList.remove('hidden');
}

function updateData() {
    if(editId) {
        database.ref('wateja/' + editId).update({
            jina: document.getElementById('custName').value,
            kiasi: document.getElementById('custAmount').value,
            namba: document.getElementById('custPhone').value
        });
        cancelEdit();
    }
}

function cancelEdit() {
    editId = null;
    clearForm();
    document.getElementById('formTitle').innerText = "üì° SAJILI MTEJA";
    document.getElementById('saveBtn').classList.remove('hidden');
    document.getElementById('updateBtn').classList.add('hidden');
    document.getElementById('cancelBtn').classList.add('hidden');
}

// SMS FUPI
function sendShortSMS(name, phone) {
    const text = `Habari ${name}, Karibu MOSHARUTH WiFi. Username: RUGI, Pass: goldnature44. Karibu tena!`;
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, '_blank');
}

function deleteCust(id) { if(confirm("Futa?")) database.ref('wateja/' + id).remove(); }
function clearForm() { 
    document.getElementById('custName').value=""; 
    document.getElementById('custAmount').value=""; 
    document.getElementById('custPhone').value=""; 
}
</script>
</body>
</html>
